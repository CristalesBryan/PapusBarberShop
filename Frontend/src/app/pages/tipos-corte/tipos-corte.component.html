<div class="container-fluid page-container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-cut"></i> Gesti칩n de Tipos de Corte</h2>
    <button class="cssbuttons-io-button" (click)="abrirFormularioAgregar()">
      <svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M0 0h24v24H0z" fill="none"></path>
        <path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="currentColor"></path>
      </svg>
      <span>Nuevo Tipo de Corte</span>
    </button>
  </div>

  <div class="card mb-4" *ngIf="mostrarFormulario">
    <div class="card-header">
      <h5>{{ tipoCorteEditando ? 'Editar' : 'Nuevo' }} Tipo de Corte</h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="guardarTipoCorte()">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Nombre *</label>
            <input type="text" class="form-control" [(ngModel)]="nuevoTipoCorte.nombre" name="nombre" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Descripci칩n</label>
            <input type="text" class="form-control" [(ngModel)]="nuevoTipoCorte.descripcion" name="descripcion">
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Tiempo *</label>
            <input type="text" class="form-control" [(ngModel)]="tiempoFormatoLegible" name="tiempoFormatoLegible" 
                   placeholder="Ej: 1h 25min o 30min" required>
            <small class="form-text text-muted">Formato: 1h 25min, 30min, 2h, etc.</small>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Precio (Q) *</label>
            <input type="number" class="form-control" [(ngModel)]="nuevoTipoCorte.precio" name="precio" step="0.01" min="0" required>
          </div>
          <div class="col-md-4 mb-3">
            <label class="form-label">Barberos Asignados</label>
            <div class="border rounded p-3" style="max-height: 200px; overflow-y: auto; background-color: #f8f9fa;">
              <div class="d-flex align-items-center mb-3">
                <label class="neon-checkbox me-3">
                  <input type="checkbox" 
                         [checked]="barberosSeleccionados.length === 0" 
                         (change)="toggleCualquierBarbero()">
                  <div class="neon-checkbox__frame">
                    <div class="neon-checkbox__box">
                      <div class="neon-checkbox__check-container">
                        <svg viewBox="0 0 24 24" class="neon-checkbox__check">
                          <path d="M3,12.5l7,7L21,5"></path>
                        </svg>
                      </div>
                      <div class="neon-checkbox__glow"></div>
                      <div class="neon-checkbox__borders">
                        <span></span><span></span><span></span><span></span>
                      </div>
                    </div>
                    <div class="neon-checkbox__effects">
                      <div class="neon-checkbox__particles">
                        <span></span><span></span><span></span><span></span>
                        <span></span><span></span><span></span><span></span>
                        <span></span><span></span><span></span><span></span>
                      </div>
                      <div class="neon-checkbox__rings">
                        <div class="ring"></div>
                        <div class="ring"></div>
                        <div class="ring"></div>
                      </div>
                      <div class="neon-checkbox__sparks">
                        <span></span><span></span><span></span><span></span>
                      </div>
                    </div>
                  </div>
                </label>
                <label class="form-check-label" style="cursor: pointer; margin: 0;" (click)="toggleCualquierBarbero()">
                  Cualquier barbero
                </label>
              </div>
              <div *ngFor="let barbero of barberos" class="d-flex align-items-center mb-3">
                <label class="neon-checkbox me-3">
                  <input type="checkbox" 
                         [checked]="estaBarberoSeleccionado(barbero.id)"
                         (change)="toggleBarbero(barbero.id)">
                  <div class="neon-checkbox__frame">
                    <div class="neon-checkbox__box">
                      <div class="neon-checkbox__check-container">
                        <svg viewBox="0 0 24 24" class="neon-checkbox__check">
                          <path d="M3,12.5l7,7L21,5"></path>
                        </svg>
                      </div>
                      <div class="neon-checkbox__glow"></div>
                      <div class="neon-checkbox__borders">
                        <span></span><span></span><span></span><span></span>
                      </div>
                    </div>
                    <div class="neon-checkbox__effects">
                      <div class="neon-checkbox__particles">
                        <span></span><span></span><span></span><span></span>
                        <span></span><span></span><span></span><span></span>
                        <span></span><span></span><span></span><span></span>
                      </div>
                      <div class="neon-checkbox__rings">
                        <div class="ring"></div>
                        <div class="ring"></div>
                        <div class="ring"></div>
                      </div>
                      <div class="neon-checkbox__sparks">
                        <span></span><span></span><span></span><span></span>
                      </div>
                    </div>
                  </div>
                </label>
                <label class="form-check-label" style="cursor: pointer; margin: 0;" (click)="toggleBarbero(barbero.id)">
                  {{ barbero.nombre }}
                </label>
              </div>
            </div>
            <small class="form-text text-muted">
              Seleccione los barberos que pueden realizar este tipo de corte. Si no selecciona ninguno, cualquier barbero podr치 realizarlo.
            </small>
          </div>
        </div>
        <div class="alert alert-danger" *ngIf="mensajeError">
          {{ mensajeError }}
        </div>
        <div class="d-flex gap-2 mt-3">
          <button type="submit" class="save-button" [disabled]="guardando" aria-label="Guardar">
            <span *ngIf="guardando" class="spinner-border spinner-border-sm me-2"></span>
            <div class="svg-wrapper-1">
              <div class="svg-wrapper">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="30"
                  height="30"
                  class="icon"
                >
                  <path
                    d="M22,15.04C22,17.23 20.24,19 18.07,19H5.93C3.76,19 2,17.23 2,15.04C2,13.07 3.43,11.44 5.31,11.14C5.28,11 5.27,10.86 5.27,10.71C5.27,9.33 6.38,8.2 7.76,8.2C8.37,8.2 8.94,8.43 9.37,8.8C10.14,7.05 11.13,5.44 13.91,5.44C17.28,5.44 18.87,8.06 18.87,10.83C18.87,10.94 18.87,11.06 18.86,11.17C20.65,11.54 22,13.13 22,15.04Z"
                  ></path>
                </svg>
              </div>
            </div>
            <span>Guardar</span>
          </button>
          <button type="button" class="button" (click)="cancelar()" [disabled]="guardando">
            <span>Cancelar</span>
            <span>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-miterlimit="2" stroke-linejoin="round" fill-rule="evenodd" clip-rule="evenodd"><path fill-rule="nonzero" d="m12.002 2.005c5.518 0 9.998 4.48 9.998 9.997 0 5.518-4.48 9.998-9.998 9.998-5.517 0-9.997-4.48-9.997-9.998 0-5.517 4.48-9.997 9.997-9.997zm0 1.5c-4.69 0-8.497 3.807-8.497 8.497s3.807 8.498 8.497 8.498 8.498-3.808 8.498-8.498-3.808-8.497-8.498-8.497zm0 7.425 2.717-2.718c.146-.146.339-.219.531-.219.404 0 .75.325.75.75 0 .193-.073.384-.219.531l-2.717 2.717 2.727 2.728c.147.147.22.339.22.531 0 .427-.349.75-.75.75-.192 0-.384-.073-.53-.219l-2.729-2.728-2.728 2.728c-.146.146-.338.219-.53.219-.401 0-.751-.323-.751-.75 0-.192.073-.384.22-.531l2.728-2.728-2.722-2.722c-.146-.147-.219-.338-.219-.531 0-.425.346-.749.75-.749.192 0 .385.073.531.219z"></path></svg>
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><h5>Lista de Tipos de Corte</h5></div>
    <div class="card-body">
      <div class="table-responsive" *ngIf="!cargando">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Descripci칩n</th>
              <th>Tiempo</th>
              <th>Precio</th>
              <th>Barbero</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tipo of tiposCorte">
              <td>{{ tipo.id }}</td>
              <td><strong>{{ tipo.nombre }}</strong></td>
              <td>{{ tipo.descripcion || 'N/A' }}</td>
              <td>{{ convertirTiempoALegible(tipo.tiempoMinutos) }}</td>
              <td>Q{{ tipo.precio | number:'1.2-2' }}</td>
              <td>{{ tipo.barberoNombre || 'Cualquier barbero' }}</td>
              <td>
                <div class="d-flex gap-2">
                  <button class="editBtn" (click)="editar(tipo)" title="Editar">
                    <svg height="1em" viewBox="0 0 512 512">
                      <path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"></path>
                    </svg>
                  </button>
                  <button class="bin-button" (click)="eliminar(tipo)" title="Eliminar">
                  <svg class="bin-top" viewBox="0 0 39 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line y1="5" x2="39" y2="5" stroke="white" stroke-width="4"></line>
                    <line x1="12" y1="1.5" x2="26.0357" y2="1.5" stroke="white" stroke-width="3"></line>
                  </svg>
                  <svg class="bin-bottom" viewBox="0 0 33 39" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <mask id="path-1-inside-1_8_19" fill="white">
                      <path d="M0 0H33V35C33 37.2091 31.2091 39 29 39H4C1.79086 39 0 37.2091 0 35V0Z"></path>
                    </mask>
                    <path d="M0 0H33H0ZM37 35C37 39.4183 33.4183 43 29 43H4C-0.418278 43 -4 39.4183 -4 35H4H29H37ZM4 43C-0.418278 43 -4 39.4183 -4 35V0H4V35V43ZM37 0V35C37 39.4183 33.4183 43 29 43V35V0H37Z" fill="white" mask="url(#path-1-inside-1_8_19)"></path>
                    <path d="M12 6L12 29" stroke="white" stroke-width="4"></path>
                    <path d="M21 6V29" stroke="white" stroke-width="4"></path>
                  </svg>
                </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="tiposCorte.length === 0">
              <td colspan="7" class="text-center text-muted">No hay tipos de corte registrados</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="text-center" *ngIf="cargando">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>
    </div>
  </div>
</div>

